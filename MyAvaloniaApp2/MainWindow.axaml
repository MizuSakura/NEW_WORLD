<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:MyAvaloniaApp2"
        x:Class="MyAvaloniaApp2.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Title="AI Factory Control Panel (MVVM Edition)"
        Width="800" Height="650">

    <Grid ColumnDefinitions="320,*" RowDefinitions="*" Margin="10">
        
        <TabControl Grid.Column="0">
            <TabItem Header="Simulation">
                <ScrollViewer>
                    <StackPanel Spacing="10" Margin="10">
                        
                        <TextBlock FontWeight="Bold">Base Settings</TextBlock>
                        <Grid ColumnDefinitions="Auto,*" RowDefinitions="*,*,*,*,*,*,*,* " RowSpacing="5">
                             <Label Grid.Row="0" Grid.Column="0" VerticalAlignment="Center">R:</Label>
                            <TextBox Text="{Binding R}" Grid.Row="0" Grid.Column="1"/>

                            <Label Grid.Row="1" Grid.Column="0" VerticalAlignment="Center">C:</Label>
                            <TextBox Text="{Binding C}" Grid.Row="1" Grid.Column="1"/>

                            <Label Grid.Row="2" Grid.Column="0" VerticalAlignment="Center">dt:</Label>
                            <TextBox Text="{Binding Dt}" Grid.Row="2" Grid.Column="1"/>

                            <Label Grid.Row="3" Grid.Column="0" VerticalAlignment="Center">Setpoint:</Label>
                            <TextBox Text="{Binding Setpoint}" Grid.Row="3" Grid.Column="1"/>

                            <Label Grid.Row="4" Grid.Column="0" VerticalAlignment="Center">Sim Time:</Label>
                            <TextBox Text="{Binding TimeSim}" Grid.Row="4" Grid.Column="1"/>

                            <Label Grid.Row="5" Grid.Column="0" VerticalAlignment="Center">Amplitude:</Label>
                            <TextBox Text="{Binding Amplitude}" Grid.Row="5" Grid.Column="1"/>

                            <Label Grid.Row="6" Grid.Column="0" VerticalAlignment="Center">Control Mode:</Label>
                            <ComboBox Grid.Row="6" Grid.Column="1"
                                    ItemsSource="{Binding ControlModes}"
                                    SelectedItem="{Binding SelectedControlMode}"/>

                            <Label Grid.Row="7" Grid.Column="0" VerticalAlignment="Center">Signal Type:</Label>
                            <ComboBox Grid.Row="7" Grid.Column="1"
                                    ItemsSource="{Binding SignalTypes}"
                                    SelectedItem="{Binding SelectedSignalType}"/>
                        </Grid>


                             

                        <CheckBox Margin="0,15,0,0" IsChecked="{Binding IsBatchModeEnabled}">
                            Enable Batch Mode
                        </CheckBox>

                        <Panel IsVisible="{Binding !IsBatchModeEnabled}">
                            <StackPanel Spacing="10">
                                <TextBlock FontWeight="Bold" Margin="0,5,0,0">Single Signal</TextBlock>
                                <Grid ColumnDefinitions="*,2*" RowDefinitions="*,*" RowSpacing="5">
                                    <Label Grid.Row="0" Grid.Column="0" VerticalAlignment="Center">Duty Cycle:</Label>
                                    <TextBox Text="{Binding Duty}" Grid.Row="0" Grid.Column="1"/>
                                    <Label Grid.Row="1" Grid.Column="0" VerticalAlignment="Center">Frequency:</Label>
                                    <TextBox Text="{Binding Freq}" Grid.Row="1" Grid.Column="1"/>
                                </Grid>
                            </StackPanel>
                        </Panel>

                        <Panel IsVisible="{Binding IsBatchModeEnabled}">
                             <StackPanel Spacing="10">
                                <TextBlock FontWeight="Bold" Margin="0,5,0,0">Duty Cycle Range</TextBlock>
                                <Grid ColumnDefinitions="*,2*" RowDefinitions="*,*,*" RowSpacing="5">
                                    <Label Grid.Row="0" Grid.Column="0" VerticalAlignment="Center">Start:</Label>
                                    <TextBox Text="{Binding DutyStart}" Grid.Row="0" Grid.Column="1"/>
                                    <Label Grid.Row="1" Grid.Column="0" VerticalAlignment="Center">End:</Label>
                                    <TextBox Text="{Binding DutyEnd}" Grid.Row="1" Grid.Column="1"/>
                                    <Label Grid.Row="2" Grid.Column="0" VerticalAlignment="Center">Steps:</Label>
                                    <TextBox Text="{Binding DutySteps}" Grid.Row="2" Grid.Column="1"/>
                                </Grid>
                                
                                <TextBlock FontWeight="Bold" Margin="0,5,0,0">Frequency Range</TextBlock>
                                <Grid ColumnDefinitions="*,2*" RowDefinitions="*,*,*" RowSpacing="5">
                                    <Label Grid.Row="0" Grid.Column="0" VerticalAlignment="Center">Start:</Label>
                                    <TextBox Text="{Binding FreqStart}" Grid.Row="0" Grid.Column="1"/>
                                    <Label Grid.Row="1" Grid.Column="0" VerticalAlignment="Center">End:</Label>
                                    <TextBox Text="{Binding FreqEnd}" Grid.Row="1" Grid.Column="1"/>
                                    <Label Grid.Row="2" Grid.Column="0" VerticalAlignment="Center">Steps:</Label>
                                    <TextBox Text="{Binding FreqSteps}" Grid.Row="2" Grid.Column="1"/>
                                </Grid>
                            </StackPanel>
                        </Panel>

                        <Button Command="{Binding RunSimulationCommand}"
                                IsEnabled="{Binding IsNotBusy}"
                                HorizontalAlignment="Stretch" Classes="accent" Margin="0,20,0,0">
                                Run Simulation
                        </Button>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
            
            <TabItem Header="Data Scaling">
                <StackPanel Spacing="10" Margin="10">
                    <TextBlock TextWrapping="Wrap">Click the button below to start the data scaling process based on the CSV files generated by the simulation.</TextBlock>
                    <Button Command="{Binding StartScalingCommand}"
                            IsEnabled="{Binding IsNotBusy}"
                            HorizontalAlignment="Stretch" Margin="0,10,0,0">
                        Start Data Scaling
                    </Button>
                </StackPanel>
            </TabItem>
        </TabControl>

        <DockPanel Grid.Column="1" Margin="10,0,0,0">
            <TextBlock DockPanel.Dock="Top" FontSize="18" FontWeight="Bold">Process Log</TextBlock>
            <Border BorderBrush="Gray" BorderThickness="1" Margin="0,5,0,0">
                <ScrollViewer>
                    <TextBlock Text="{Binding LogText}" Padding="5" TextWrapping="Wrap" FontFamily="Consolas,Monospace"/>
                </ScrollViewer>
            </Border>
        </DockPanel>
    </Grid>
</Window>